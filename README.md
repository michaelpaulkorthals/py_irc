# py_irc
## Python infrared remote control utilities for Raspberry Pi ##

In the home theater, the devices (e.g. Bluray player, projector, monitor, amplifier, lights, etc.) are usually controlled with infrared remote controls. The problem is that the operation of these devices is completely different and separated. Each device is controlled with its own remote control. This turns the home theater into an uncomfortable, complex technical workplace until the movie is shown.

In order to optimize this situation, it is desirable to combine the individual operating procedures at the push of a single button, e.g.:
 * Play the movie with the projector on the screen in a quiet sound mix
   * Configure the 4x4 4K HDMI Matrix to connect the devices:
     * Input: 4K Bluray Player
     * Output: 4K HDMI to analog 7.1 extractor
     * Output: Projector
   * Turn on the 4K projector
   * Turn on the 4K Bluray Player
   * Enable 4K HDMI to analog 7.1 extractor
   * Switch on dynamic compressor for channels FL, FR, CENTER, SUBW
   * Switch on dynamic compressor for channels SL, SR, RL, RR
   * Switch 7 speakers and a subwoofer line-out to the analog amplifier
   * Switch on analog amplifier 7.1
   * Adjust the sound volume accordingly depending on the time of day
   * Switch the subwoofer off
   * Open the Bluray Player drive
   * Switch off the lights or roll down the blinds depending on the time of day

## Hardware ##

This requires to build up and LAMP Server on a headless Raspberry Pi Zero W. This webserver will provide the website with that and further macro buttons on your mobile phone or tablet. 

In addition the Raspberry Pi Zero W must be extended by IR Receiver and Transmitter circuits and a 5 V power supply. 

The complete device could look like this:

![Infrared Remote control outside](https://github.com/michaelpaulkorthals/py_irc/blob/main/images/rpi_irc_1.png)

![Infrared Remote control inside](https://github.com/michaelpaulkorthals/py_irc/blob/main/images/rpi_irc_2.png)

This prototype I have successfully in operation in my home theatre since November 2020.

As an expierienced DIY home automation expert, you are capable to build this device easily and to have fun on a rainy weekend.

Please note:
The photo above shows an in-build switching power supply, which converts the power from 230V AC to 5V DC. This needs the skills of a licenced Ham Radio operator, electrician, electrical or electronic engineer. If you don't have these competences, you must replace this by an commercially available plug-in power supply for Raspberry Pi with a low voltage power cord to the device. 

> Keep every time in mind that open voltages over 40 V (e.g. 110 V AC or 230 V AC from the power grid) could cause deadly injuries.

Study the [schematic diagrams](https://github.com/michaelpaulkorthals/py_irc/blob/main/irc_circuit/irc_circuit.pdf) and data sheets of my infrared remote control in the [irc_circuit folder](https://github.com/michaelpaulkorthals/py_irc/tree/main/irc_circuit).
May this help you to find a way to design your own device. In the event that you want to adopt the circuit to your own needs or capabilities, I have also uploaded the files of my ["KiCad"](https://www.kicad.org/) project there.

## Software ##

Please note: The 3 Python files I share with you are only working on Debian based Linux on Raspberry Pi hardware and Raspbian Buster+ with Python 3.6+ and LIRC software installed and correctly configured and tested.

  * "irc_learn.py": This utility scans the key presses of the original IRC hardware and save these to a JSON data file.
  * "irc_send.py": This utility simulates the key presses of the original IRC hardware, which has been learned before by the "irc_learn.py." and saved to a JSON file.
  * "irc_api.py": An API module for Raspberry Pi, e.g. to send IR remote control codes via a TCP / IP service.

This software is backwards compatible JSON files you could have already generated by ["irrp.py"](https://github.com/souri-t/RemoteControl-RPI/blob/master/remote/bin/irrp). The key names and codes of these files will be automatically converted to the actual data model, used here. Thanks [Souri-T](https://github.com/souri-t) for that code, which made it easier for me to get started with this topic.

The "irc_learn.py" uses the LIRC utility "mode2" only to get the temporal definition of the decoded IR signal. From my point of view, we get more precise result, when using a C-compiled program like "LIRC/mode2".

In sending IR signals with "irc-send.py", I use the same raw signal approach like "irrp.py". It is easy to use Raspberry Pi-internal features in Python to output a precise IR signal. 

But with this software I go beyond LIRC and "irrp.py". It is capable to precisely immitate the remote controls with double layer protocols, which are build for newer Japanese middle and high class consumer electronics devices.

Please use the "--help" parameter to get information about the features of the utilities.

The really smart module is "irc_api.py". Integrate it into a secure TLS TCP/IP daemon to receive IR signal requests from your home theatre web application.

I will explain this later.
